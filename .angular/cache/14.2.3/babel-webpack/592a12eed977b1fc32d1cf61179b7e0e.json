{"ast":null,"code":"import _classCallCheck from \"C:/Users/nsuwanw/Desktop/smartlocker-sp/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/nsuwanw/Desktop/smartlocker-sp/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { ItemDetailAvailabilityContainer, LocationResponse, LocationCountry, LocationSite, WatchDTO, ItemDTO } from 'src/app/shared/model';\nimport { HttpClient } from '@angular/common/http';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\n\nfunction AvailabilityComponent_div_0_ng_container_8_option_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 6);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    var country_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngValue\", country_r5);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(country_r5.country.name);\n  }\n}\n\nfunction AvailabilityComponent_div_0_ng_container_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, AvailabilityComponent_div_0_ng_container_8_option_1_Template, 2, 2, \"option\", 11);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    var ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.locations.countries);\n  }\n}\n\nfunction AvailabilityComponent_div_0_ng_container_13_option_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 6);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    var site_r7 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngValue\", site_r7);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(site_r7.site.name);\n  }\n}\n\nfunction AvailabilityComponent_div_0_ng_container_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, AvailabilityComponent_div_0_ng_container_13_option_1_Template, 2, 2, \"option\", 11);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    var ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.activeCountry.sites);\n  }\n}\n\nfunction AvailabilityComponent_div_0_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"div\", 13)(2, \"div\", 14);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 15);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 16)(7, \"div\", 17);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    var container_r8 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(container_r8.container.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", container_r8.country.name, \" / \", container_r8.site.name, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate2(\"\", container_r8.available, \"/\", container_r8.total, \"\");\n  }\n}\n\nvar _c0 = function _c0(a0) {\n  return {\n    \"disabled\": a0\n  };\n};\n\nfunction AvailabilityComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r10 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"div\", 3);\n    i0.ɵɵtext(3, \"Availability\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 4)(5, \"select\", 5);\n    i0.ɵɵlistener(\"ngModelChange\", function AvailabilityComponent_div_0_Template_select_ngModelChange_5_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      var ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.activeCountry = $event);\n    })(\"change\", function AvailabilityComponent_div_0_Template_select_change_5_listener() {\n      i0.ɵɵrestoreView(_r10);\n      var ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.changeParams());\n    });\n    i0.ɵɵelementStart(6, \"option\", 6);\n    i0.ɵɵtext(7, \"All\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, AvailabilityComponent_div_0_ng_container_8_Template, 2, 1, \"ng-container\", 7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"div\", 8)(10, \"select\", 5);\n    i0.ɵɵlistener(\"ngModelChange\", function AvailabilityComponent_div_0_Template_select_ngModelChange_10_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      var ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.activeSite = $event);\n    })(\"change\", function AvailabilityComponent_div_0_Template_select_change_10_listener() {\n      i0.ɵɵrestoreView(_r10);\n      var ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.changeParams());\n    });\n    i0.ɵɵelementStart(11, \"option\", 6);\n    i0.ɵɵtext(12, \"All\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(13, AvailabilityComponent_div_0_ng_container_13_Template, 2, 1, \"ng-container\", 7);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(14, \"div\", 9);\n    i0.ɵɵtemplate(15, AvailabilityComponent_div_0_div_15_Template, 9, 5, \"div\", 10);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    var ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.activeCountry);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngValue\", null);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.locations);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(8, _c0, ctx_r0.activeCountry == null));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.activeSite);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngValue\", null);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.activeCountry);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.filteredAvailability);\n  }\n}\n\nexport var AvailabilityComponent = /*#__PURE__*/(function () {\n  var AvailabilityComponent = /*#__PURE__*/function () {\n    function AvailabilityComponent(http, _route, _router) {\n      _classCallCheck(this, AvailabilityComponent);\n\n      this.http = http;\n      this._route = _route;\n      this._router = _router;\n      this.activeCountry = null;\n      this.activeSite = null;\n      this.isNotifiable = false; // this.http = new HttpClient(handler);\n    }\n\n    _createClass(AvailabilityComponent, [{\n      key: \"ngOnInit\",\n      value: function ngOnInit() {\n        this.fetchCountires();\n      }\n    }, {\n      key: \"fetchCountires\",\n      value: function fetchCountires() {\n        var _this = this;\n\n        var endpoint = \"https://smartlocker20220922110147.azurewebsites.net/api/online/browse-locations\";\n        console.log(\"Fetching containers...\", endpoint);\n        this.http.get(endpoint).subscribe(function (data) {\n          _this.locations = data;\n\n          _this._route.queryParams.subscribe(function (queries) {\n            console.log(queries);\n            if (queries.countryId != null) _this.activeCountry = _this.locations.countries.find(function (x) {\n              return x.country.id == queries.countryId;\n            });\n            if (queries.siteId != null && _this.activeCountry != null) _this.activeSite = _this.activeCountry.sites.find(function (x) {\n              return x.site.id == queries.siteId;\n            });\n\n            _this.changeParams();\n          });\n        });\n      }\n    }, {\n      key: \"changeParams\",\n      value: function changeParams() {\n        var _this2 = this;\n\n        var countryId = null;\n        if (this.activeCountry) countryId = this.activeCountry.country.id;\n        var siteId = null;\n        if (this.activeSite) siteId = this.activeSite.site.id;\n        console.log(this.activeSite);\n\n        this._router.navigate([], {\n          relativeTo: this._route,\n          queryParams: {\n            countryId: countryId,\n            siteId: siteId,\n            containerId: null\n          },\n          queryParamsHandling: 'merge'\n        });\n\n        this.filteredAvailability = JSON.parse(JSON.stringify(this.availability));\n        if (this.activeCountry) this.filteredAvailability = this.filteredAvailability.filter(function (x) {\n          return x.country.id == _this2.activeCountry.country.id;\n        });\n        if (this.activeSite) this.filteredAvailability = this.filteredAvailability.filter(function (x) {\n          return x.site.id == _this2.activeSite.site.id;\n        });\n        console.log(this.filteredAvailability);\n      }\n    }, {\n      key: \"notifyMe\",\n      value: function notifyMe(container) {\n        this.http.post(\"https://smartlocker20220922110147.azurewebsites.net/api/online/items/\".concat(this.item.id, \"/watch\"), {\n          \"containerId\": container.container.id\n        }).subscribe(function (data) {\n          container.watch = data;\n        });\n      }\n    }, {\n      key: \"unnotifyMe\",\n      value: function unnotifyMe(container) {\n        this.http.delete(\"https://smartlocker20220922110147.azurewebsites.net/api/online/items/\".concat(this.item.id, \"/watch/\").concat(container.watch.id)).subscribe(function (data) {\n          container.watch = null;\n        });\n      }\n    }]);\n\n    return AvailabilityComponent;\n  }();\n\n  AvailabilityComponent.ɵfac = function AvailabilityComponent_Factory(t) {\n    return new (t || AvailabilityComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i2.Router));\n  };\n\n  AvailabilityComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AvailabilityComponent,\n    selectors: [[\"app-availability\"]],\n    inputs: {\n      availability: \"availability\",\n      item: \"item\"\n    },\n    decls: 1,\n    vars: 1,\n    consts: [[\"class\", \"item-availability\", 4, \"ngIf\"], [1, \"item-availability\"], [1, \"availability-header\"], [1, \"availability-title\"], [1, \"availability-country\"], [\"name\", \"\", \"id\", \"\", 3, \"ngModel\", \"ngModelChange\", \"change\"], [3, \"ngValue\"], [4, \"ngIf\"], [1, \"availability-site\", 3, \"ngClass\"], [1, \"availability-list\"], [\"class\", \"list-container\", 4, \"ngFor\", \"ngForOf\"], [3, \"ngValue\", 4, \"ngFor\", \"ngForOf\"], [1, \"list-container\"], [1, \"container-text\"], [1, \"container-name\"], [1, \"container-location\"], [1, \"container-availability\"], [1, \"availability-number\"]],\n    template: function AvailabilityComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, AvailabilityComponent_div_0_Template, 16, 10, \"div\", 0);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.availability);\n      }\n    },\n    dependencies: [i3.NgClass, i3.NgForOf, i3.NgIf, i4.NgSelectOption, i4.ɵNgSelectMultipleOption, i4.SelectControlValueAccessor, i4.NgControlStatus, i4.NgModel],\n    styles: [\".item-availability[_ngcontent-%COMP%]{margin-left:2rem;flex:0 0 300px}.item-availability[_ngcontent-%COMP%]   .availability-header[_ngcontent-%COMP%]{background:linear-gradient(to right,#007096,#00ACA8);padding:1rem;color:#fff}.item-availability[_ngcontent-%COMP%]   .availability-header[_ngcontent-%COMP%]   .availability-title[_ngcontent-%COMP%]{font-weight:500;line-height:1.5rem}.item-availability[_ngcontent-%COMP%]   .availability-header[_ngcontent-%COMP%]   .availability-country[_ngcontent-%COMP%], .item-availability[_ngcontent-%COMP%]   .availability-header[_ngcontent-%COMP%]   .availability-site[_ngcontent-%COMP%]{font-size:.9rem;line-height:1rem}.item-availability[_ngcontent-%COMP%]   .availability-header[_ngcontent-%COMP%]   .availability-site.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.item-availability[_ngcontent-%COMP%]   .availability-header[_ngcontent-%COMP%]   .availability-container[_ngcontent-%COMP%]{font-size:.9rem;line-height:1rem}.item-availability[_ngcontent-%COMP%]   .availability-header[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{border:none;background:none;color:#fff;font-family:EMPrint;padding:0}.item-availability[_ngcontent-%COMP%]   .availability-header[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{color:#000}.item-availability[_ngcontent-%COMP%]   .availability-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:.5rem 1rem;border:1px solid #eee}.item-availability[_ngcontent-%COMP%]   .availability-list[_ngcontent-%COMP%]   .list-container[_ngcontent-%COMP%]{display:flex;padding:.5rem 0}.item-availability[_ngcontent-%COMP%]   .availability-list[_ngcontent-%COMP%]   .list-container[_ngcontent-%COMP%] + .list-container[_ngcontent-%COMP%]{border-top:1px solid #eee}.item-availability[_ngcontent-%COMP%]   .availability-list[_ngcontent-%COMP%]   .list-container[_ngcontent-%COMP%]   .container-text[_ngcontent-%COMP%]{flex:1 1 auto}.item-availability[_ngcontent-%COMP%]   .availability-list[_ngcontent-%COMP%]   .list-container[_ngcontent-%COMP%]   .container-text[_ngcontent-%COMP%]   .container-name[_ngcontent-%COMP%]{font-weight:500}.item-availability[_ngcontent-%COMP%]   .availability-list[_ngcontent-%COMP%]   .list-container[_ngcontent-%COMP%]   .container-text[_ngcontent-%COMP%]   .container-location[_ngcontent-%COMP%]{color:#888;text-transform:uppercase;font-size:.7rem;line-height:1rem}.item-availability[_ngcontent-%COMP%]   .availability-list[_ngcontent-%COMP%]   .list-container[_ngcontent-%COMP%]   .container-availability[_ngcontent-%COMP%]{font-weight:500}\"]\n  });\n  return AvailabilityComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}